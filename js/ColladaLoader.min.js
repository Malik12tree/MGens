/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/collada-loader-three@0.0.3/index.js
 * 
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import*as THREE from"three";let ColladaLoader=function(){var e,t,i,s,r,a,n,o,h,l,c=null,p=null,d=null,u={},f={},m={},g={},v={},y={},b={},w={},x={},N={centerGeometry:!1,convertUpAxis:!1,subdivideFaces:!0,upAxis:"Y",defaultEnvMap:null},k=1,T="Y",E=null;function R(l,u,R){if(c=(new DOMParser).parseFromString(l,"text/xml"),u=u||d,void 0!==R){var A=R.split("/");A.pop(),n=(A.length<1?".":A.join("/"))+"/"}!function(){var e=c.querySelectorAll("asset")[0];if(e&&e.childNodes)for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];switch(i.nodeName){case"unit":var s=i.getAttribute("meter");s&&(k=parseFloat(s));break;case"up_axis":T=i.textContent.charAt(0)}}}(),function(){if(!0!==N.convertUpAxis||T===N.upAxis)E=null;else switch(T){case"X":E="Y"===N.upAxis?"XtoY":"XtoZ";break;case"Y":E="X"===N.upAxis?"YtoX":"YtoZ";break;case"Z":E="X"===N.upAxis?"ZtoX":"ZtoY"}}(),f=_("library_images image",V,"image"),y=_("library_materials material",se,"material"),b=_("library_effects effect",he,"effect"),v=_("library_geometries geometry",U,"geometry"),w=_("library_cameras camera",fe,"camera"),x=_("library_lights light",ge,"light"),g=_("library_controllers controller",X,"controller"),m=_("library_animations animation",ce,"animation"),r=_("library_visual_scenes visual_scene",Z,"visual_scene"),a=_("library_kinematics_models kinematics_model",ye,"kinematics_model"),o=[],h=[],e=function(){var e=c.querySelectorAll("scene instance_visual_scene")[0];if(e){var t=e.getAttribute("url").replace(/^#/,"");return r[t.length>0?t:"visual_scene0"]}return null}(),p=new THREE.Group;for(var C=0;C<e.nodes.length;C++)p.add(j(e.nodes[C]));p.scale.multiplyScalar(k),i=[],function t(s){var r=e.getChildById(s.colladaId,!0),a=null;if(r&&r.keys){a={fps:60,hierarchy:[{node:r,keys:r.keys,sids:r.sids}],node:s,name:"animation_"+s.name,length:0},i.push(a);for(var n=0,o=r.keys.length;n<o;n++)a.length=Math.max(a.length,r.keys[n].time)}else a={hierarchy:[{keys:[],sids:[]}]};for(var n=0,o=s.children.length;n<o;n++)for(var h=t(s.children[n]),l=0,c=h.hierarchy.length;l<c;l++)a.hierarchy.push({keys:[],sids:[]});return a}(p),t=function(){var e=c.querySelectorAll("instance_kinematics_model")[0];if(e){var t=e.getAttribute("url").replace(/^#/,"");return a[t.length>0?t:"kinematics_model0"]}return null}(),function(){if(t&&0===t.joints.length)return void(s=void 0);var i={},r=function(s,r){var a=r.getAttribute("id"),n=e.getChildById(a,!0),o=t.joints[s];p.traverse(function(e){e.colladaId==a&&(i[s]={node:e,transforms:n.transforms,joint:o,position:o.zeroPosition})})};s={joints:t&&t.joints,getJointValue:function(e){var t=i[e];if(t)return t.position;console.log("getJointValue: joint "+e+" doesn't exist")},setJointValue:function(e,t){var s=i[e];if(s){var r=s.joint;if(t>r.limits.max||t<r.limits.min)console.log("setJointValue: joint "+e+" value "+t+" outside of limits (min: "+r.limits.min+", max: "+r.limits.max+")");else if(r.static)console.log("setJointValue: joint "+e+" is static");else{var a=s.node,o=r.axis,h=s.transforms,l=new THREE.Matrix4,c=new THREE.Matrix4;for(n=0;n<h.length;n++){var p=h[n];if(p.sid&&-1!==p.sid.indexOf("joint"+e))switch(r.type){case"revolute":l.multiply(c.makeRotationAxis(o,THREE.Math.degToRad(t)));break;case"prismatic":l.multiply(c.makeTranslation(o.x*t,o.y*t,o.z*t));break;default:console.warn("setJointValue: unknown joint type: "+r.type)}else switch(p.type){case"matrix":l.multiply(p.obj);break;case"translate":l.multiply(c.makeTranslation(p.obj.x,p.obj.y,p.obj.z));break;case"rotate":l.multiply(c.makeRotationAxis(p.obj,p.angle))}}var d=l.elements,u=Array.prototype.slice.call(d),f=[u[0],u[4],u[8],u[12],u[1],u[5],u[9],u[13],u[2],u[6],u[10],u[14],u[3],u[7],u[11],u[15]];a.matrix.set.apply(a.matrix,f),a.matrix.decompose(a.position,a.quaternion,a.scale),i[e].position=t}}else console.log("setJointValue: joint "+e+" doesn't exist")}};var a=c.querySelector("scene instance_kinematics_scene");if(a)for(var n=0;n<a.childNodes.length;n++){var o=a.childNodes[n];if(1==o.nodeType)switch(o.nodeName){case"bind_joint_axis":var h=o.getAttribute("target").split("/").pop(),l=o.querySelector("axis param").textContent,d=parseInt(l.split("joint").pop().split(".")[0]),u=c.querySelector('[sid="'+h+'"]');if(u){var f=u.parentElement;r(d,f)}}}}();var M={scene:p,morphs:o,skins:h,animations:i,kinematics:s,dae:{images:f,materials:y,cameras:w,lights:x,effects:b,geometries:v,controllers:g,animations:m,visualScenes:r,visualScene:e,scene:e,kinematicsModels:a,kinematicsModel:t}};return u&&u(M),M}function _(e,t,i){for(var s=c.querySelectorAll(e),r={},a=0,n=s.length,o=0;o<n;o++){var h=s[o],l=(new t).parse(h);l.id&&0!==l.id.length||(l.id=i+a++),r[l.id]=l}return r}function A(e,t){var i=t instanceof B?g[t.url]:t;if(i&&i.morph){for(var s=i.morph,r=0;r<s.targets.length;r++){var a=s.targets[r],n=v[a];if(n.mesh&&n.mesh.primitives&&n.mesh.primitives.length){var o=n.mesh.primitives[0].geometry;o.vertices.length===e.vertices.length&&e.morphTargets.push({name:"target_1",vertices:o.vertices})}}e.morphTargets.push({name:"target_Z",vertices:e.vertices})}else console.log("could not find morph controller!")}function C(e,t,i,s){if(e.world=e.world||new THREE.Matrix4,e.localworld=e.localworld||new THREE.Matrix4,e.world.copy(e.matrix),e.localworld.copy(e.matrix),e.channels&&e.channels.length){var r=e.channels[0].sampler.output[i];r instanceof THREE.Matrix4&&(e.world.copy(r),e.localworld.copy(r),0===i&&e.matrix.copy(r))}s&&e.world.multiplyMatrices(s,e.world),t.push(e);for(var a=0;a<e.nodes.length;a++)C(e.nodes[a],t,i,e.world)}function M(e,t){for(var i=0;i<e.length;i++){var s=e[i],r=-1;if("JOINT"==s.type){for(var a=0;a<t.joints.length;a++)if(s.sid===t.joints[a]){r=a;break}if(r>=0){var n=t.invBindMatrices[r];s.invBindMatrix=n,s.skinningMatrix=new THREE.Matrix4,s.skinningMatrix.multiplyMatrices(s.world,n),s.animatrix=new THREE.Matrix4,s.animatrix.copy(s.localworld),s.weights=[];for(a=0;a<t.weights.length;a++)for(var o=0;o<t.weights[a].length;o++){var h=t.weights[a][o];h.joint===r&&s.weights.push(h)}}else console.warn("ColladaLoader: Could not find joint '"+s.sid+"'."),s.skinningMatrix=new THREE.Matrix4,s.weights=[]}}}function H(t,i,s){void 0===s&&(s=40);var r=g[i.url];if(r&&r.skin)if(i.skeleton&&i.skeleton.length){for(var a=function(){var e,t=1e6,i=-t,s=0;for(var r in m){var a=m[r];e=e||a.id;for(var n=0;n<a.sampler.length;n++){var o=a.sampler[n];o.create(),t=Math.min(t,o.startTime),i=Math.max(i,o.endTime),s=Math.max(s,o.input.length)}}return{start:t,end:i,frames:s,ID:e}}(),n=e.getChildById(i.skeleton[0],!0)||e.getChildBySid(i.skeleton[0],!0),o=function(e){var t=[],i=function(e,t,s){var r={};r.name=t.sid,r.parent=e,r.matrix=t.matrix;var a=[new THREE.Vector3,new THREE.Quaternion,new THREE.Vector3];for(var n in r.matrix.decompose(a[0],a[1],a[2]),r.pos=[a[0].x,a[0].y,a[0].z],r.scl=[a[2].x,a[2].y,a[2].z],r.rotq=[a[1].x,a[1].y,a[1].z,a[1].w],s.push(r),t.nodes)i(t.sid,t.nodes[n],s)};return i(-1,e,t),t}(n),h=r.skin.joints,l=[],c=0;c<h.length;c++)for(var p=0;p<o.length;p++)o[p].name===h[c]&&(l[c]=o[p]);for(var c=0;c<l.length;c++)for(var p=0;p<l.length;p++)l[c].parent===l[p].name&&(l[c].parent=p);new THREE.Vector3;for(c=0;c<t.vertices.length;c++)t.vertices[c].applyMatrix4(r.skin.bindShapeMatrix);var d=[],u=[],f=r.skin.weights;for(c=0;c<f.length;c++){var v=new THREE.Vector4(f[c][0]?f[c][0].joint:0,f[c][1]?f[c][1].joint:0,f[c][2]?f[c][2].joint:0,f[c][3]?f[c][3].joint:0),y=new THREE.Vector4(f[c][0]?f[c][0].weight:0,f[c][1]?f[c][1].weight:0,f[c][2]?f[c][2].weight:0,f[c][3]?f[c][3].weight:0);d.push(v),u.push(y)}t.skinIndices=d,t.skinWeights=u,t.bones=l;var b={name:a.ID,fps:30,length:a.frames/30,hierarchy:[]};for(p=0;p<l.length;p++)b.hierarchy.push({parent:l[p].parent,name:l[p].name,keys:[]});for(console.log("ColladaLoader:",a.ID+" has "+l.length+" bones."),function(e,t,i){var s=[];C(t,s,-1),M(s,i.skin);for(var r=new THREE.Vector3,a=[],n=0;n<e.vertices.length;n++)a.push(new THREE.Vector3);for(n=0;n<s.length;n++)if("JOINT"==s[n].type)for(var o=0;o<s[n].weights.length;o++){var h=s[n].weights[o],l=h.index,c=h.weight,p=e.vertices[l],d=a[l];r.x=p.x,r.y=p.y,r.z=p.z,r.applyMatrix4(s[n].skinningMatrix),d.x+=r.x*c,d.y+=r.y*c,d.z+=r.z*c}for(n=0;n<e.vertices.length;n++)e.vertices[n]=a[n]}(t,n,r),s=0;s<a.frames;s++){var w=[];C(n,w,s),M(w,r.skin);for(c=0;c<w.length;c++)for(p=0;p<b.hierarchy.length;p++)if(b.hierarchy[p].name===w[c].sid){var x={};x.time=s/30,x.matrix=w[c].animatrix,0===s&&(w[c].matrix=x.matrix);var N=[new THREE.Vector3,new THREE.Quaternion,new THREE.Vector3];x.matrix.decompose(N[0],N[1],N[2]),x.pos=[N[0].x,N[0].y,N[0].z],x.scl=[N[2].x,N[2].y,N[2].z],x.rot=N[1],b.hierarchy[p].keys.push(x)}t.animation=b}}else console.log("ColladaLoader: Could not find the skeleton for the skin. ");else console.log("ColladaLoader: Could not find skin controller.")}function j(e,t){var i,s,r,a,n=new THREE.Object3D;for(r=0;r<e.controllers.length;r++){var l=g[e.controllers[r].url];switch(l.type){case"skin":if(v[l.skin.source])(p=new P).url=l.skin.source,p.instance_material=e.controllers[r].instance_material,e.geometries.push(p),!0,i=e.controllers[r];else if(g[l.skin.source]){var c=g[l.skin.source];if(s=c,c.morph&&v[c.morph.source])(p=new P).url=c.morph.source,p.instance_material=e.controllers[r].instance_material,e.geometries.push(p)}break;case"morph":var p;if(v[l.morph.source])(p=new P).url=l.morph.source,p.instance_material=e.controllers[r].instance_material,e.geometries.push(p),s=e.controllers[r];console.log("ColladaLoader: Morph-controller partially supported.")}}var d={};for(r=0;r<e.geometries.length;r++){var u,f=e.geometries[r],m=f.instance_material,k=v[f.url],T={},E=[],R=0;if(k){if(!k.mesh||!k.mesh.primitives)continue;if(0===n.name.length&&(n.name=k.id),m)for(a=0;a<m.length;a++){var _=m[a],C=y[_.target],M=C.instance_effect.url,O=b[M].shader.material;if(k.doubleSided){if(!(_.symbol in d)){var S=O.clone();S.side=THREE.DoubleSide,d[_.symbol]=S}O=d[_.symbol]}O.opacity=O.opacity?O.opacity:1,T[_.symbol]=R,E.push(O),(u=O).name=null===C.name||""===C.name?C.id:C.name,R++}var I,q=u||new THREE.MeshLambertMaterial({color:14540253,side:k.doubleSided?THREE.DoubleSide:THREE.FrontSide}),V=k.mesh.geometry3js;if(R>1)for(q=new THREE.MultiMaterial(E),a=0;a<V.faces.length;a++){var X=V.faces[a];X.materialIndex=T[X.daeMaterial]}void 0!==i?(H(V,i),V.morphTargets.length>0?(q.morphTargets=!0,q.skinning=!1):(q.morphTargets=!1,q.skinning=!0),(I=new THREE.SkinnedMesh(V,q,!1)).name="skin_"+h.length,h.push(I)):void 0!==s?(A(V,s),q.morphTargets=!0,(I=new THREE.Mesh(V,q)).name="morph_"+o.length,o.push(I)):I=!0===V.isLineStrip?new THREE.Line(V):new THREE.Mesh(V,q),n.add(I)}}for(r=0;r<e.cameras.length;r++){var L=e.cameras[r],Y=w[L.url],Z=new THREE.PerspectiveCamera(Y.yfov,parseFloat(Y.aspect_ratio),parseFloat(Y.znear),parseFloat(Y.zfar));n.add(Z)}for(r=0;r<e.lights.length;r++){var z=null,F=e.lights[r],B=x[F.url];if(B&&B.technique){var D=B.color.getHex(),U=B.intensity,G=B.distance,J=B.falloff_angle;switch(B.technique){case"directional":(z=new THREE.DirectionalLight(D,U,G)).position.set(0,0,1);break;case"point":z=new THREE.PointLight(D,U,G);break;case"spot":(z=new THREE.SpotLight(D,U,G,J)).position.set(0,0,1);break;case"ambient":z=new THREE.AmbientLight(D)}}z&&n.add(z)}if(n.name=e.name||e.id||"",n.colladaId=e.id||"",n.layer=e.layer||"",n.matrix=e.matrix,n.matrix.decompose(n.position,n.quaternion,n.scale),N.centerGeometry&&n.geometry){var W=n.geometry.center();W.multiply(n.scale),W.applyQuaternion(n.quaternion),n.position.sub(W)}for(r=0;r<e.nodes.length;r++)n.add(j(e.nodes[r],e));return n}function O(e){for(var t=c.querySelectorAll("library_nodes node"),i=0;i<t.length;i++){var s=t[i].attributes.getNamedItem("id");if(s&&s.value===e)return t[i]}}function S(e,t){for(var i=null,s=0,r=e.length;s<r&&null===i;s++){var a=e[s];if(a.time===t)i=a;else if(a.time>t)break}return i}function I(e,t){for(var i=-1,s=0,r=e.length;s<r&&-1===i;s++){e[s].time>=t&&(i=s)}return i}function q(e,t,i,s){var r=function(e,t,i){for(i=i>=0?i:i+e.length;i>=0;i--){var s=e[i];if(s.hasTarget(t))return s}return null}(e,s,i?i-1:0),a=function(e,t,i){for(;i<e.length;i++){var s=e[i];if(s.hasTarget(t))return s}return null}(e,s,i+1);if(r&&a){var n,o=(t.time-r.time)/(a.time-r.time),h=r.getTarget(s),l=a.getTarget(s).data,c=h.data;if("matrix"===h.type)n=c;else if(c.length){n=[];for(var p=0;p<c.length;++p)n[p]=c[p]+(l[p]-c[p])*o}else n=c+(l-c)*o;t.addTarget(s,h.transform,h.member,n)}}function V(){this.id="",this.init_from=""}function X(){this.id="",this.name="",this.type="",this.skin=null,this.morph=null}function L(){this.method=null,this.source=null,this.targets=null,this.weights=null}function Y(){this.source="",this.bindShapeMatrix=null,this.invBindMatrices=[],this.joints=[],this.weights=[]}function Z(){this.id="",this.name="",this.nodes=[],this.scene=new THREE.Group}function z(){this.id="",this.name="",this.sid="",this.nodes=[],this.controllers=[],this.transforms=[],this.geometries=[],this.channels=[],this.matrix=new THREE.Matrix4}function F(){this.sid="",this.type="",this.data=[],this.obj=null}function B(){this.url="",this.skeleton=[],this.instance_material=[]}function D(){this.symbol="",this.target=""}function P(){this.url="",this.instance_material=[]}function U(){this.id="",this.mesh=null}function G(e){this.geometry=e.id,this.primitives=[],this.vertices=null,this.geometry3js=null}function J(){this.material="",this.count=0,this.inputs=[],this.vcount=null,this.p=[],this.geometry=new THREE.Geometry}function W(){J.call(this),this.vcount=[]}function Q(){J.call(this),this.vcount=1}function $(){J.call(this),this.vcount=3}function K(){this.source="",this.count=0,this.stride=0,this.params=[]}function ee(){this.input={}}function te(){this.semantic="",this.offset=0,this.source="",this.set=0}function ie(e){this.id=e,this.type=null}function se(){this.id="",this.name="",this.instance_effect=null}function re(){this.color=new THREE.Color,this.color.setRGB(Math.random(),Math.random(),Math.random()),this.color.a=1,this.texture=null,this.texcoord=null,this.texOpts=null}function ae(e,t){this.type=e,this.effect=t,this.material=null}function ne(e){this.effect=e,this.init_from=null,this.format=null}function oe(e){this.effect=e,this.source=null,this.wrap_s=null,this.wrap_t=null,this.minfilter=null,this.magfilter=null,this.mipfilter=null}function he(){this.id="",this.name="",this.shader=null,this.surface={},this.sampler={}}function le(){this.url=""}function ce(){this.id="",this.name="",this.source={},this.sampler=[],this.channel=[]}function pe(e){this.animation=e,this.source="",this.target="",this.fullSid=null,this.sid=null,this.dotSyntax=null,this.arrSyntax=null,this.arrIndices=null,this.member=null}function de(e){this.id="",this.animation=e,this.inputs=[],this.input=null,this.output=null,this.strideOut=null,this.interpolation=null,this.startTime=null,this.endTime=null,this.duration=0}function ue(e){this.targets=[],this.time=e}function fe(){this.id="",this.name="",this.technique=""}function me(){this.url=""}function ge(){this.id="",this.name="",this.technique=""}function ve(){this.url=""}function ye(){this.id="",this.name="",this.joints=[],this.links=[]}function be(){this.sid="",this.name="",this.axis=new THREE.Vector3,this.limits={min:0,max:0},this.type="",this.static=!1,this.zeroPosition=0,this.middlePosition=0}function we(){this.sid="",this.name="",this.transforms=[],this.attachments=[]}function xe(){this.joint="",this.transforms=[],this.links=[]}function Ne(e){var t=e.getAttribute("id");return null!=u[t]?u[t]:(u[t]=new ie(t).parse(e),u[t])}function ke(e){for(var t=Re(e),i=[],s=0,r=t.length;s<r;s++)i.push("true"===t[s]||"1"===t[s]);return i}function Te(e){for(var t=Re(e),i=[],s=0,r=t.length;s<r;s++)i.push(parseFloat(t[s]));return i}function Ee(e){for(var t=Re(e),i=[],s=0,r=t.length;s<r;s++)i.push(parseInt(t[s],10));return i}function Re(e){return e.length>0?function(e){return e.replace(/^\s+/,"").replace(/\s+$/,"")}(e).split(/\s+/):[]}function _e(e,t,i){return e.hasAttribute(t)?parseInt(e.getAttribute(t),10):i}function Ae(e,t){(new THREE.ImageLoader).load(t,function(t){e.image=t,e.needsUpdate=!0})}function Ce(e,t){e.doubleSided=!1;var i=t.querySelectorAll("extra double_sided")[0];i&&i&&1===parseInt(i.textContent,10)&&(e.doubleSided=!0)}function Me(e,t){if(!0===N.convertUpAxis&&T!==N.upAxis)switch(E){case"XtoY":var i=e[0];e[0]=t*e[1],e[1]=i;break;case"XtoZ":i=e[2];e[2]=e[1],e[1]=e[0],e[0]=i;break;case"YtoX":i=e[0];e[0]=e[1],e[1]=t*i;break;case"YtoZ":i=e[1];e[1]=t*e[2],e[2]=i;break;case"ZtoX":i=e[0];e[0]=e[1],e[1]=e[2],e[2]=i;break;case"ZtoY":i=e[1];e[1]=e[2],e[2]=t*i}}function He(e,t){var i=[e[t],e[t+1],e[t+2]];return Me(i,-1),new THREE.Vector3(i[0],i[1],i[2])}function je(e){if(N.convertUpAxis){var t=[e[0],e[4],e[8]];Me(t,-1),e[0]=t[0],e[4]=t[1],e[8]=t[2],Me(t=[e[1],e[5],e[9]],-1),e[1]=t[0],e[5]=t[1],e[9]=t[2],Me(t=[e[2],e[6],e[10]],-1),e[2]=t[0],e[6]=t[1],e[10]=t[2],Me(t=[e[0],e[1],e[2]],-1),e[0]=t[0],e[1]=t[1],e[2]=t[2],Me(t=[e[4],e[5],e[6]],-1),e[4]=t[0],e[5]=t[1],e[6]=t[2],Me(t=[e[8],e[9],e[10]],-1),e[8]=t[0],e[9]=t[1],e[10]=t[2],Me(t=[e[3],e[7],e[11]],-1),e[3]=t[0],e[7]=t[1],e[11]=t[2]}return(new THREE.Matrix4).set(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function Oe(e){if(e>-1&&e<3){e={X:0,Y:1,Z:2}[e=Se(["X","Y","Z"][e])]}return e}function Se(e){if(N.convertUpAxis)switch(e){case"X":switch(E){case"XtoY":case"XtoZ":case"YtoX":e="Y";break;case"ZtoX":e="Z"}break;case"Y":switch(E){case"XtoY":case"YtoX":case"ZtoX":e="X";break;case"XtoZ":case"YtoZ":case"ZtoY":e="Z"}break;case"Z":switch(E){case"XtoZ":e="X";break;case"YtoZ":case"ZtoX":case"ZtoY":e="Y"}}return e}return V.prototype.parse=function(e){this.id=e.getAttribute("id");for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];"init_from"===i.nodeName&&(this.init_from=i.textContent)}return this},X.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name"),this.type="none";for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];switch(i.nodeName){case"skin":this.skin=(new Y).parse(i),this.type=i.nodeName;break;case"morph":this.morph=(new L).parse(i),this.type=i.nodeName}}return this},L.prototype.parse=function(e){var t,i={},s=[];for(this.method=e.getAttribute("method"),this.source=e.getAttribute("source").replace(/^#/,""),t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];if(1==r.nodeType)switch(r.nodeName){case"source":i[(n=(new ie).parse(r)).id]=n;break;case"targets":s=this.parseInputs(r);break;default:console.log(r.nodeName)}}for(t=0;t<s.length;t++){var a=s[t],n=i[a.source];switch(a.semantic){case"MORPH_TARGET":this.targets=n.read();break;case"MORPH_WEIGHT":this.weights=n.read()}}return this},L.prototype.parseInputs=function(e){for(var t=[],i=0;i<e.childNodes.length;i++){var s=e.childNodes[i];if(1==s.nodeType)switch(s.nodeName){case"input":t.push((new te).parse(s))}}return t},Y.prototype.parse=function(e){var t,i,s={};this.source=e.getAttribute("source").replace(/^#/,""),this.invBindMatrices=[],this.joints=[],this.weights=[];for(var r=0;r<e.childNodes.length;r++){var a=e.childNodes[r];if(1==a.nodeType)switch(a.nodeName){case"bind_shape_matrix":var n=Te(a.textContent);this.bindShapeMatrix=je(n);break;case"source":var o=(new ie).parse(a);s[o.id]=o;break;case"joints":t=a;break;case"vertex_weights":i=a;break;default:console.log(a.nodeName)}}return this.parseJoints(t,s),this.parseWeights(i,s),this},Y.prototype.parseJoints=function(e,t){for(var i=0;i<e.childNodes.length;i++){var s=e.childNodes[i];if(1==s.nodeType)switch(s.nodeName){case"input":var r=(new te).parse(s),a=t[r.source];"JOINT"===r.semantic?this.joints=a.read():"INV_BIND_MATRIX"===r.semantic&&(this.invBindMatrices=a.read())}}},Y.prototype.parseWeights=function(e,t){for(var i,s,r=[],a=0;a<e.childNodes.length;a++){var n=e.childNodes[a];if(1==n.nodeType)switch(n.nodeName){case"input":r.push((new te).parse(n));break;case"v":i=Ee(n.textContent);break;case"vcount":s=Ee(n.textContent)}}var o=0;for(a=0;a<s.length;a++){for(var h=s[a],l=[],c=0;c<h;c++){for(var p={},d=0;d<r.length;d++){var u=r[d],f=i[o+u.offset];switch(u.semantic){case"JOINT":p.joint=f;break;case"WEIGHT":p.weight=t[u.source].data[f]}}l.push(p),o+=r.length}for(c=0;c<l.length;c++)l[c].index=a;this.weights.push(l)}},Z.prototype.getChildById=function(e,t){for(var i=0;i<this.nodes.length;i++){var s=this.nodes[i].getChildById(e,t);if(s)return s}return null},Z.prototype.getChildBySid=function(e,t){for(var i=0;i<this.nodes.length;i++){var s=this.nodes[i].getChildBySid(e,t);if(s)return s}return null},Z.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name"),this.nodes=[];for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"node":this.nodes.push((new z).parse(i))}}return this},z.prototype.getChannelForTransform=function(e){for(var t=0;t<this.channels.length;t++){var i,s=this.channels[t],r=s.target.split("/"),a=(r.shift(),r.shift()),n=a.indexOf(".")>=0,o=a.indexOf("(")>=0;if(n)r=a.split("."),a=r.shift();else if(o){i=a.split("("),a=i.shift();for(var h=0;h<i.length;h++)i[h]=parseInt(i[h].replace(/\)/,""))}if(a===e)return s.info={sid:a,dotSyntax:n,arrSyntax:o,arrIndices:i},s}return null},z.prototype.getChildById=function(e,t){if(this.id===e)return this;if(t)for(var i=0;i<this.nodes.length;i++){var s=this.nodes[i].getChildById(e,t);if(s)return s}return null},z.prototype.getChildBySid=function(e,t){if(this.sid===e)return this;if(t)for(var i=0;i<this.nodes.length;i++){var s=this.nodes[i].getChildBySid(e,t);if(s)return s}return null},z.prototype.getTransformBySid=function(e){for(var t=0;t<this.transforms.length;t++)if(this.transforms[t].sid===e)return this.transforms[t];return null},z.prototype.parse=function(e){this.id=e.getAttribute("id"),this.sid=e.getAttribute("sid"),this.name=e.getAttribute("name"),this.type=e.getAttribute("type"),this.layer=e.getAttribute("layer"),this.type="JOINT"===this.type?this.type:"NODE",this.nodes=[],this.transforms=[],this.geometries=[],this.cameras=[],this.lights=[],this.controllers=[],this.matrix=new THREE.Matrix4;for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"node":this.nodes.push((new z).parse(i));break;case"instance_camera":this.cameras.push((new me).parse(i));break;case"instance_controller":this.controllers.push((new B).parse(i));break;case"instance_geometry":this.geometries.push((new P).parse(i));break;case"instance_light":this.lights.push((new ve).parse(i));break;case"instance_node":var s=O(i.getAttribute("url").replace(/^#/,""));s&&this.nodes.push((new z).parse(s));break;case"rotate":case"translate":case"scale":case"matrix":case"lookat":case"skew":this.transforms.push((new F).parse(i));break;case"extra":break;default:console.log(i.nodeName)}}return this.channels=function(e){var t=[],i=1e6,s=-1e6;for(var r in m)for(var a=m[r],n=0;n<a.channel.length;n++){var o=a.channel[n],h=a.sampler[n];(r=o.target.split("/")[0])==e.id&&(h.create(),o.sampler=h,i=Math.min(i,h.startTime),s=Math.max(s,h.endTime),t.push(o))}return t.length&&(e.startTime=i,e.endTime=s),t}(this),function(e){if(e.channels&&e.channels.length){for(var t=[],i=[],s=0,r=e.channels.length;s<r;s++){var a,n=e.channels[s],o=n.fullSid,h=n.sampler,l=h.input,c=e.getTransformBySid(n.sid);if(n.arrIndices){a=[];for(var p=0,d=n.arrIndices.length;p<d;p++)a[p]=Oe(n.arrIndices[p])}else a=Se(n.member);if(c)for(-1===i.indexOf(o)&&i.push(o),p=0,d=l.length;p<d;p++){var u=l[p],f=h.getData(c.type,p,a);if(!(v=S(t,u))){v=new ue(u);var m=I(t,u);t.splice(-1===m?t.length:m,0,v)}v.addTarget(o,c,a,f)}else console.log('Could not find transform "'+n.sid+'" in node '+e.id)}for(s=0;s<i.length;s++){var g=i[s];for(p=0;p<t.length;p++){var v;(v=t[p]).hasTarget(g)||q(t,v,p,g)}}e.keys=t,e.sids=i}}(this),this.updateMatrix(),this},z.prototype.updateMatrix=function(){this.matrix.identity();for(var e=0;e<this.transforms.length;e++)this.transforms[e].apply(this.matrix)},F.prototype.parse=function(e){return this.sid=e.getAttribute("sid"),this.type=e.nodeName,this.data=Te(e.textContent),this.convert(),this},F.prototype.convert=function(){switch(this.type){case"matrix":this.obj=je(this.data);break;case"rotate":this.angle=THREE.Math.degToRad(this.data[3]);case"translate":Me(this.data,-1),this.obj=new THREE.Vector3(this.data[0],this.data[1],this.data[2]);break;case"scale":Me(this.data,1),this.obj=new THREE.Vector3(this.data[0],this.data[1],this.data[2]);break;default:console.log("Can not convert Transform of type "+this.type)}},F.prototype.apply=(l=new THREE.Matrix4,function(e){switch(this.type){case"matrix":e.multiply(this.obj);break;case"translate":e.multiply(l.makeTranslation(this.obj.x,this.obj.y,this.obj.z));break;case"rotate":e.multiply(l.makeRotationAxis(this.obj,this.angle));break;case"scale":e.scale(this.obj)}}),F.prototype.update=function(e,t){var i=["X","Y","Z","ANGLE"];switch(this.type){case"matrix":if(t)if(1===t.length)switch(t[0]){case 0:this.obj.n11=e[0],this.obj.n21=e[1],this.obj.n31=e[2],this.obj.n41=e[3];break;case 1:this.obj.n12=e[0],this.obj.n22=e[1],this.obj.n32=e[2],this.obj.n42=e[3];break;case 2:this.obj.n13=e[0],this.obj.n23=e[1],this.obj.n33=e[2],this.obj.n43=e[3];break;case 3:this.obj.n14=e[0],this.obj.n24=e[1],this.obj.n34=e[2],this.obj.n44=e[3]}else if(2===t.length){var s="n"+(t[0]+1)+(t[1]+1);this.obj[s]=e}else console.log("Incorrect addressing of matrix in transform.");else this.obj.copy(e);break;case"translate":case"scale":switch("[object Array]"===Object.prototype.toString.call(t)&&(t=i[t[0]]),t){case"X":this.obj.x=e;break;case"Y":this.obj.y=e;break;case"Z":this.obj.z=e;break;default:this.obj.x=e[0],this.obj.y=e[1],this.obj.z=e[2]}break;case"rotate":switch("[object Array]"===Object.prototype.toString.call(t)&&(t=i[t[0]]),t){case"X":this.obj.x=e;break;case"Y":this.obj.y=e;break;case"Z":this.obj.z=e;break;case"ANGLE":this.angle=THREE.Math.degToRad(e);break;default:this.obj.x=e[0],this.obj.y=e[1],this.obj.z=e[2],this.angle=THREE.Math.degToRad(e[3])}}},B.prototype.parse=function(e){this.url=e.getAttribute("url").replace(/^#/,""),this.skeleton=[],this.instance_material=[];for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1===i.nodeType)switch(i.nodeName){case"skeleton":this.skeleton.push(i.textContent.replace(/^#/,""));break;case"bind_material":for(var s=i.querySelectorAll("instance_material"),r=0;r<s.length;r++){var a=s[r];this.instance_material.push((new D).parse(a))}}}return this},D.prototype.parse=function(e){return this.symbol=e.getAttribute("symbol"),this.target=e.getAttribute("target").replace(/^#/,""),this},P.prototype.parse=function(e){this.url=e.getAttribute("url").replace(/^#/,""),this.instance_material=[];for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType&&"bind_material"===i.nodeName){for(var s=i.querySelectorAll("instance_material"),r=0;r<s.length;r++){var a=s[r];this.instance_material.push((new D).parse(a))}break}}return this},U.prototype.parse=function(e){this.id=e.getAttribute("id"),Ce(this,e);for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];switch(i.nodeName){case"mesh":this.mesh=new G(this).parse(i)}}return this},G.prototype.parse=function(e){this.primitives=[];for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];switch(i.nodeName){case"source":Ne(i);break;case"vertices":this.vertices=(new ee).parse(i);break;case"linestrips":this.primitives.push((new Q).parse(i));break;case"triangles":this.primitives.push((new $).parse(i));break;case"polygons":this.primitives.push((new J).parse(i));break;case"polylist":this.primitives.push((new W).parse(i))}}if(this.geometry3js=new THREE.Geometry,null===this.vertices)return this;var s=u[this.vertices.input.POSITION.source].data;for(t=0;t<s.length;t+=3)this.geometry3js.vertices.push(He(s,t).clone());for(t=0;t<this.primitives.length;t++){var r=this.primitives[t];r.setVertices(this.vertices),this.handlePrimitive(r,this.geometry3js)}return this.geometry3js.calcNormals&&(this.geometry3js.computeVertexNormals(),delete this.geometry3js.calcNormals),this},G.prototype.handlePrimitive=function(e,t){if(e instanceof Q)t.isLineStrip=!0;else{var i,s,r,a,n,o,h,l,c=e.p,p=e.inputs,d=0,f=0,m=[];for(i=0;i<p.length;i++){var g=(r=p[i]).offset+1;switch(f=f<g?g:f,r.semantic){case"TEXCOORD":m.push(r.set)}}for(var v=0;v<c.length;++v)for(var y=c[v],b=0;b<y.length;){var w=[],x=[],k=null,T=[];for(l=e.vcount?e.vcount.length?e.vcount[d++]:e.vcount:y.length/f,i=0;i<l;i++)for(s=0;s<p.length;s++)switch(r=p[s],o=u[r.source],n=(a=y[b+i*f+r.offset])*(h=o.accessor.params.length),r.semantic){case"VERTEX":w.push(a);break;case"NORMAL":x.push(He(o.data,n));break;case"TEXCOORD":void 0===(k=k||{})[r.set]&&(k[r.set]=[]),k[r.set].push(new THREE.Vector2(o.data[n],o.data[n+1]));break;case"COLOR":T.push((new THREE.Color).setRGB(o.data[n],o.data[n+1],o.data[n+2]))}if(0===x.length)if(r=this.vertices.input.NORMAL){h=(o=u[r.source]).accessor.params.length;for(var E=0,R=w.length;E<R;E++)x.push(He(o.data,w[E]*h))}else t.calcNormals=!0;if(!k&&(k={},r=this.vertices.input.TEXCOORD)){m.push(r.set),h=(o=u[r.source]).accessor.params.length;for(E=0,R=w.length;E<R;E++)n=w[E]*h,void 0===k[r.set]&&(k[r.set]=[]),k[r.set].push(new THREE.Vector2(o.data[n],1-o.data[n+1]))}if(0===T.length&&(r=this.vertices.input.COLOR)){h=(o=u[r.source]).accessor.params.length;for(E=0,R=w.length;E<R;E++)n=w[E]*h,T.push((new THREE.Color).setRGB(o.data[n],o.data[n+1],o.data[n+2]))}var _,A,C=null,M=[];if(3===l)M.push(new THREE.Face3(w[0],w[1],w[2],x,T.length?T:new THREE.Color));else if(4===l)M.push(new THREE.Face3(w[0],w[1],w[3],x.length?[x[0].clone(),x[1].clone(),x[3].clone()]:[],T.length?[T[0],T[1],T[3]]:new THREE.Color)),M.push(new THREE.Face3(w[1],w[2],w[3],x.length?[x[1].clone(),x[2].clone(),x[3].clone()]:[],T.length?[T[1],T[2],T[3]]:new THREE.Color));else if(l>4&&N.subdivideFaces){var H=T.length?T:new THREE.Color;for(s=1;s<l-1;)M.push(new THREE.Face3(w[0],w[s],w[s+1],x.length?[x[0].clone(),x[s++].clone(),x[s].clone()]:[],H))}if(M.length)for(E=0,R=M.length;E<R;E++)for((C=M[E]).daeMaterial=e.material,t.faces.push(C),s=0;s<m.length;s++)_=k[m[s]],A=l>4?[_[0],_[E+1],_[E+2]]:4===l?0===E?[_[0],_[1],_[3]]:[_[1].clone(),_[2],_[3].clone()]:[_[0],_[1],_[2]],void 0===t.faceVertexUvs[s]&&(t.faceVertexUvs[s]=[]),t.faceVertexUvs[s].push(A);else console.log("dropped face with vcount "+l+" for geometry with id: "+t.id);b+=f*l}}},J.prototype.setVertices=function(e){for(var t=0;t<this.inputs.length;t++)this.inputs[t].source===e.id&&(this.inputs[t].source=e.input.POSITION.source)},J.prototype.parse=function(e){this.material=e.getAttribute("material"),this.count=_e(e,"count",0);for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];switch(i.nodeName){case"input":this.inputs.push((new te).parse(e.childNodes[t]));break;case"vcount":this.vcount=Ee(i.textContent);break;case"p":this.p.push(Ee(i.textContent));break;case"ph":console.warn("polygon holes not yet supported!")}}return this},W.prototype=Object.create(J.prototype),W.prototype.constructor=W,Q.prototype=Object.create(J.prototype),Q.prototype.constructor=Q,$.prototype=Object.create(J.prototype),$.prototype.constructor=$,K.prototype.parse=function(e){this.params=[],this.source=e.getAttribute("source"),this.count=_e(e,"count",0),this.stride=_e(e,"stride",0);for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if("param"===i.nodeName){var s={};s.name=i.getAttribute("name"),s.type=i.getAttribute("type"),this.params.push(s)}}return this},ee.prototype.parse=function(e){this.id=e.getAttribute("id");for(var t=0;t<e.childNodes.length;t++)if("input"===e.childNodes[t].nodeName){var i=(new te).parse(e.childNodes[t]);this.input[i.semantic]=i}return this},te.prototype.parse=function(e){return this.semantic=e.getAttribute("semantic"),this.source=e.getAttribute("source").replace(/^#/,""),this.set=_e(e,"set",-1),this.offset=_e(e,"offset",0),"TEXCOORD"===this.semantic&&this.set<0&&(this.set=0),this},ie.prototype.parse=function(e){this.id=e.getAttribute("id");for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];switch(i.nodeName){case"bool_array":this.data=ke(i.textContent),this.type=i.nodeName;break;case"float_array":this.data=Te(i.textContent),this.type=i.nodeName;break;case"int_array":this.data=Ee(i.textContent),this.type=i.nodeName;break;case"IDREF_array":case"Name_array":this.data=Re(i.textContent),this.type=i.nodeName;break;case"technique_common":for(var s=0;s<i.childNodes.length;s++)if("accessor"===i.childNodes[s].nodeName){this.accessor=(new K).parse(i.childNodes[s]);break}}}return this},ie.prototype.read=function(){var e=[],t=this.accessor.params[0];switch(t.type){case"IDREF":case"Name":case"name":case"float":return this.data;case"float4x4":for(var i=0;i<this.data.length;i+=16){var s=je(this.data.slice(i,i+16));e.push(s)}break;default:console.log("ColladaLoader: Source: Read dont know how to read "+t.type+".")}return e},se.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name");for(var t=0;t<e.childNodes.length;t++)if("instance_effect"===e.childNodes[t].nodeName){this.instance_effect=(new le).parse(e.childNodes[t]);break}return this},re.prototype.isColor=function(){return null===this.texture},re.prototype.isTexture=function(){return null!=this.texture},re.prototype.parse=function(e){"transparent"===e.nodeName&&(this.opaque=e.getAttribute("opaque"));for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"color":var s=Te(i.textContent);this.color=new THREE.Color,this.color.setRGB(s[0],s[1],s[2]),this.color.a=s[3];break;case"texture":this.texture=i.getAttribute("texture"),this.texcoord=i.getAttribute("texcoord"),this.texOpts={offsetU:0,offsetV:0,repeatU:1,repeatV:1,wrapU:1,wrapV:1},this.parseTexture(i)}}return this},re.prototype.parseTexture=function(e){if(!e.childNodes)return this;e.childNodes[1]&&"extra"===e.childNodes[1].nodeName&&(e=e.childNodes[1]).childNodes[1]&&"technique"===e.childNodes[1].nodeName&&(e=e.childNodes[1]);for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];switch(i.nodeName){case"offsetU":case"offsetV":case"repeatU":case"repeatV":this.texOpts[i.nodeName]=parseFloat(i.textContent);break;case"wrapU":case"wrapV":"TRUE"===i.textContent.toUpperCase()?this.texOpts[i.nodeName]=1:this.texOpts[i.nodeName]=parseInt(i.textContent);break;default:this.texOpts[i.nodeName]=i.textContent}}return this},ae.prototype.parse=function(e){for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"emission":case"diffuse":case"specular":case"transparent":this[i.nodeName]=(new re).parse(i);break;case"bump":var s=i.getAttribute("bumptype");s?"heightfield"===s.toLowerCase()?this.bump=(new re).parse(i):"normalmap"===s.toLowerCase()?this.normal=(new re).parse(i):(console.error("Shader.prototype.parse: Invalid value for attribute 'bumptype' ("+s+") - valid bumptypes are 'HEIGHTFIELD' and 'NORMALMAP' - defaulting to 'HEIGHTFIELD'"),this.bump=(new re).parse(i)):(console.warn("Shader.prototype.parse: Attribute 'bumptype' missing from bump node - defaulting to 'HEIGHTFIELD'"),this.bump=(new re).parse(i));break;case"shininess":case"reflectivity":case"index_of_refraction":case"transparency":var r=i.querySelectorAll("float");r.length>0&&(this[i.nodeName]=parseFloat(r[0].textContent))}}return this.create(),this},ae.prototype.create=function(){var e={},t=!1;if(void 0!==this.transparency&&void 0!==this.transparent){this.transparent;var i=(this.transparent.color.r+this.transparent.color.g+this.transparent.color.b)/3*this.transparency;i>0&&(t=!0,e.transparent=!0,e.opacity=1-i)}var s={diffuse:"map",ambient:"lightMap",specular:"specularMap",emission:"emissionMap",bump:"bumpMap",normal:"normalMap"};for(var r in this)switch(r){case"ambient":case"emission":case"diffuse":case"specular":case"bump":case"normal":var a=this[r];if(a instanceof re)if(a.isTexture()){var o=a.texture,h=this.effect.sampler[o];if(void 0!==h&&void 0!==h.source){var l=this.effect.surface[h.source];if(void 0!==l){var c=f[l.init_from];if(c){var p,d=n+c.init_from,u=THREE.Loader.Handlers.get(d);null!==u?p=u.load(d):Ae(p=new THREE.Texture,d),"MIRROR"===h.wrap_s?p.wrapS=THREE.MirroredRepeatWrapping:"WRAP"===h.wrap_s||a.texOpts.wrapU?p.wrapS=THREE.RepeatWrapping:p.wrapS=THREE.ClampToEdgeWrapping,"MIRROR"===h.wrap_t?p.wrapT=THREE.MirroredRepeatWrapping:"WRAP"===h.wrap_t||a.texOpts.wrapV?p.wrapT=THREE.RepeatWrapping:p.wrapT=THREE.ClampToEdgeWrapping,p.offset.x=a.texOpts.offsetU,p.offset.y=a.texOpts.offsetV,p.repeat.x=a.texOpts.repeatU,p.repeat.y=a.texOpts.repeatV,e[s[r]]=p,"emission"===r&&(e.emissive=16777215)}}}}else"diffuse"!==r&&t||("emission"===r?e.emissive=a.color.getHex():e[r]=a.color.getHex());break;case"shininess":e[r]=this[r];break;case"reflectivity":e[r]=this[r],e[r]>0&&(e.envMap=N.defaultEnvMap),e.combine=THREE.MixOperation;break;case"index_of_refraction":e.refractionRatio=this[r],1!==this[r]&&(e.envMap=N.defaultEnvMap)}switch(e.side=this.effect.doubleSided?THREE.DoubleSide:THREE.FrontSide,void 0!==e.diffuse&&(e.color=e.diffuse,delete e.diffuse),this.type){case"constant":null!=e.emissive&&(e.color=e.emissive),this.material=new THREE.MeshBasicMaterial(e);break;case"phong":case"blinn":this.material=new THREE.MeshPhongMaterial(e);break;case"lambert":default:this.material=new THREE.MeshLambertMaterial(e)}return this.material},ne.prototype.parse=function(e){for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"init_from":this.init_from=i.textContent;break;case"format":this.format=i.textContent;break;default:console.log("unhandled Surface prop: "+i.nodeName)}}return this},oe.prototype.parse=function(e){for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"source":this.source=i.textContent;break;case"minfilter":this.minfilter=i.textContent;break;case"magfilter":this.magfilter=i.textContent;break;case"mipfilter":this.mipfilter=i.textContent;break;case"wrap_s":this.wrap_s=i.textContent;break;case"wrap_t":this.wrap_t=i.textContent;break;default:console.log("unhandled Sampler2D prop: "+i.nodeName)}}return this},he.prototype.create=function(){if(null===this.shader)return null},he.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name"),Ce(this,e),this.shader=null;for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"profile_COMMON":this.parseTechnique(this.parseProfileCOMMON(i))}}return this},he.prototype.parseNewparam=function(e){for(var t=e.getAttribute("sid"),i=0;i<e.childNodes.length;i++){var s=e.childNodes[i];if(1==s.nodeType)switch(s.nodeName){case"surface":this.surface[t]=new ne(this).parse(s);break;case"sampler2D":this.sampler[t]=new oe(this).parse(s);break;case"extra":break;default:console.log(s.nodeName)}}},he.prototype.parseProfileCOMMON=function(e){for(var t,i=0;i<e.childNodes.length;i++){var s=e.childNodes[i];if(1==s.nodeType)switch(s.nodeName){case"profile_COMMON":this.parseProfileCOMMON(s);break;case"technique":t=s;break;case"newparam":this.parseNewparam(s);break;case"image":var r=(new V).parse(s);f[r.id]=r;break;case"extra":break;default:console.log(s.nodeName)}}return t},he.prototype.parseTechnique=function(e){for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"constant":case"lambert":case"blinn":case"phong":this.shader=new ae(i.nodeName,this).parse(i);break;case"extra":this.parseExtra(i)}}},he.prototype.parseExtra=function(e){for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"technique":this.parseExtraTechnique(i)}}},he.prototype.parseExtraTechnique=function(e){for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"bump":this.shader.parse(e)}}},le.prototype.parse=function(e){return this.url=e.getAttribute("url").replace(/^#/,""),this},ce.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name"),this.source={};for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"animation":var s=(new ce).parse(i);for(var r in s.source)this.source[r]=s.source[r];for(var a=0;a<s.channel.length;a++)this.channel.push(s.channel[a]),this.sampler.push(s.sampler[a]);break;case"source":r=(new ie).parse(i);this.source[r.id]=r;break;case"sampler":this.sampler.push(new de(this).parse(i));break;case"channel":this.channel.push(new pe(this).parse(i))}}return this},pe.prototype.parse=function(e){this.source=e.getAttribute("source").replace(/^#/,""),this.target=e.getAttribute("target");var t=this.target.split("/"),i=(t.shift(),t.shift()),s=i.indexOf(".")>=0,r=i.indexOf("(")>=0;if(s)t=i.split("."),this.sid=t.shift(),this.member=t.shift();else if(r){var a=i.split("(");this.sid=a.shift();for(var n=0;n<a.length;n++)a[n]=parseInt(a[n].replace(/\)/,""));this.arrIndices=a}else this.sid=i;return this.fullSid=i,this.dotSyntax=s,this.arrSyntax=r,this},de.prototype.parse=function(e){this.id=e.getAttribute("id"),this.inputs=[];for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"input":this.inputs.push((new te).parse(i))}}return this},de.prototype.create=function(){for(var e=0;e<this.inputs.length;e++){var t=this.inputs[e],i=this.animation.source[t.source];switch(t.semantic){case"INPUT":this.input=i.read();break;case"OUTPUT":this.output=i.read(),this.strideOut=i.accessor.stride;break;case"INTERPOLATION":this.interpolation=i.read();break;case"IN_TANGENT":case"OUT_TANGENT":break;default:console.log(t.semantic)}}if(this.startTime=0,this.endTime=0,this.duration=0,this.input.length){this.startTime=1e8,this.endTime=-1e8;for(e=0;e<this.input.length;e++)this.startTime=Math.min(this.startTime,this.input[e]),this.endTime=Math.max(this.endTime,this.input[e]);this.duration=this.endTime-this.startTime}},de.prototype.getData=function(e,t,i){var s;if("matrix"===e&&16===this.strideOut)s=this.output[t];else if(this.strideOut>1){s=[],t*=this.strideOut;for(var r=0;r<this.strideOut;++r)s[r]=this.output[t+r];if(3===this.strideOut)switch(e){case"rotate":case"translate":Me(s,-1);break;case"scale":Me(s,1)}else 4===this.strideOut&&"matrix"===e&&Me(s,-1)}else s=this.output[t],i&&"translate"===e&&(s=function(e,t){if(!0!==N.convertUpAxis||T===N.upAxis)return t;switch(e){case"X":t="XtoY"===E?-1*t:t;break;case"Y":t="YtoZ"===E||"YtoX"===E?-1*t:t;break;case"Z":t="ZtoY"===E?-1*t:t}return t}(i,s));return s},ue.prototype.addTarget=function(e,t,i,s){this.targets.push({sid:e,member:i,transform:t,data:s})},ue.prototype.apply=function(e){for(var t=0;t<this.targets.length;++t){var i=this.targets[t];e&&i.sid!==e||i.transform.update(i.data,i.member)}},ue.prototype.getTarget=function(e){for(var t=0;t<this.targets.length;++t)if(this.targets[t].sid===e)return this.targets[t];return null},ue.prototype.hasTarget=function(e){for(var t=0;t<this.targets.length;++t)if(this.targets[t].sid===e)return!0;return!1},ue.prototype.interpolate=function(e,t){for(var i=0,s=this.targets.length;i<s;i++){var r,a=this.targets[i],n=e.getTarget(a.sid);if("matrix"!==a.transform.type&&n){var o=(t-this.time)/(e.time-this.time),h=n.data,l=a.data;if(o<0&&(o=0),o>1&&(o=1),l.length){r=[];for(var c=0;c<l.length;++c)r[c]=l[c]+(h[c]-l[c])*o}else r=l+(h-l)*o}else r=a.data;a.transform.update(r,a.member)}},fe.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name");for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"optics":this.parseOptics(i)}}return this},fe.prototype.parseOptics=function(e){for(var t=0;t<e.childNodes.length;t++)if("technique_common"===e.childNodes[t].nodeName)for(var i=e.childNodes[t],s=0;s<i.childNodes.length;s++)if(this.technique=i.childNodes[s].nodeName,"perspective"===this.technique)for(var r=i.childNodes[s],a=0;a<r.childNodes.length;a++){switch((o=r.childNodes[a]).nodeName){case"yfov":this.yfov=o.textContent;break;case"xfov":this.xfov=o.textContent;break;case"znear":this.znear=o.textContent;break;case"zfar":this.zfar=o.textContent;break;case"aspect_ratio":this.aspect_ratio=o.textContent}}else if("orthographic"===this.technique){var n=i.childNodes[s];for(a=0;a<n.childNodes.length;a++){var o;switch((o=n.childNodes[a]).nodeName){case"xmag":this.xmag=o.textContent;break;case"ymag":this.ymag=o.textContent;break;case"znear":this.znear=o.textContent;break;case"zfar":this.zfar=o.textContent;break;case"aspect_ratio":this.aspect_ratio=o.textContent}}}return this},me.prototype.parse=function(e){return this.url=e.getAttribute("url").replace(/^#/,""),this},ge.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name");for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"technique_common":this.parseCommon(i);break;case"technique":this.parseTechnique(i)}}return this},ge.prototype.parseCommon=function(e){for(var t=0;t<e.childNodes.length;t++)switch(e.childNodes[t].nodeName){case"directional":case"point":case"spot":case"ambient":this.technique=e.childNodes[t].nodeName;for(var i=e.childNodes[t],s=0;s<i.childNodes.length;s++){var r=i.childNodes[s];switch(r.nodeName){case"color":var a=Te(r.textContent);this.color=new THREE.Color(0),this.color.setRGB(a[0],a[1],a[2]),this.color.a=a[3];break;case"falloff_angle":this.falloff_angle=parseFloat(r.textContent);break;case"quadratic_attenuation":var n=parseFloat(r.textContent);this.distance=n?Math.sqrt(1/n):0}}}return this},ge.prototype.parseTechnique=function(e){this.profile=e.getAttribute("profile");for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];switch(i.nodeName){case"intensity":this.intensity=parseFloat(i.textContent)}}return this},ve.prototype.parse=function(e){return this.url=e.getAttribute("url").replace(/^#/,""),this},ye.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name"),this.joints=[],this.links=[];for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"technique_common":this.parseCommon(i)}}return this},ye.prototype.parseCommon=function(e){for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(e.childNodes[t].nodeName){case"joint":this.joints.push((new be).parse(i));break;case"link":this.links.push((new we).parse(i))}}return this},be.prototype.parse=function(e){this.sid=e.getAttribute("sid"),this.name=e.getAttribute("name"),this.axis=new THREE.Vector3,this.limits={min:0,max:0},this.type="",this.static=!1,this.zeroPosition=0,this.middlePosition=0;var t=Te(e.querySelector("axis").textContent);this.axis=He(t,0);var i=e.querySelector("limits min")?parseFloat(e.querySelector("limits min").textContent):-360,s=e.querySelector("limits max")?parseFloat(e.querySelector("limits max").textContent):360;this.limits={min:i,max:s};for(var r=["prismatic","revolute"],a=0;a<r.length;a++){var n=r[a];e.querySelector(n)&&(this.type=n)}return this.limits.min>=this.limits.max&&(this.static=!0),this.middlePosition=(this.limits.min+this.limits.max)/2,this},we.prototype.parse=function(e){this.sid=e.getAttribute("sid"),this.name=e.getAttribute("name"),this.transforms=[],this.attachments=[];for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"attachment_full":this.attachments.push((new xe).parse(i));break;case"rotate":case"translate":case"matrix":this.transforms.push((new F).parse(i))}}return this},xe.prototype.parse=function(e){this.joint=e.getAttribute("joint").split("/").pop(),this.links=[];for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"link":this.links.push((new we).parse(i));break;case"rotate":case"translate":case"matrix":this.transforms.push((new F).parse(i))}}return this},{load:function(e,t,i,s){var r=0;if(document.implementation&&document.implementation.createDocument){var a=new XMLHttpRequest;a.onreadystatechange=function(){4===a.readyState?0===a.status||200===a.status?a.response?(d=t,R(a.response,void 0,e)):s?s({type:"error",url:e}):console.error("ColladaLoader: Empty or non-existing file ("+e+")"):s?s({type:"error",url:e}):console.error("ColladaLoader: Couldn't load \""+e+'" ('+a.status+")"):3===a.readyState&&i&&(0===r&&(r=a.getResponseHeader("Content-Length")),i({total:r,loaded:a.responseText.length}))},a.open("GET",e,!0),a.send(null)}else alert("Don't know how to parse XML!")},parse:R,applySkin:H,geometries:v,options:N}};export default ColladaLoader;
//# sourceMappingURL=/sm/148f8a9c533d6038b19b126069681567d10e5fa35bc5f321631a170fdc819d63.map